"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[79994],{65407:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var a=t(85893),i=t(11151);const s={slug:"fundamentals-day-3",title:"2-3. Kubernetes Fundamentals - ConfigMaps and Secrets",authors:["josh"],draft:!1,hide_table_of_contents:!1,toc_min_heading_level:2,toc_max_heading_level:3,keywords:["kubernetes","container-apps","secrets","configuration"],image:"https://azure.github.io/Cloud-Native/img/og/30-08.png",description:"Working with ConfigMaps and Secrets in Kubernetes",tags:["cloud-native","30daysofcloudnative","zero-to-hero","ask-the-expert","azure-kubernetes-service"]},o=void 0,r={permalink:"/Cloud-Native/cnny-2023/fundamentals-day-3",source:"@site/blog-cnny/2023-02-01/index.md",title:"2-3. Kubernetes Fundamentals - ConfigMaps and Secrets",description:"Working with ConfigMaps and Secrets in Kubernetes",date:"2023-02-01T00:00:00.000Z",formattedDate:"February 1, 2023",tags:[{label:"cloud-native",permalink:"/Cloud-Native/cnny-2023/tags/cloud-native"},{label:"30daysofcloudnative",permalink:"/Cloud-Native/cnny-2023/tags/30-daysofcloudnative"},{label:"zero-to-hero",permalink:"/Cloud-Native/cnny-2023/tags/zero-to-hero"},{label:"ask-the-expert",permalink:"/Cloud-Native/cnny-2023/tags/ask-the-expert"},{label:"azure-kubernetes-service",permalink:"/Cloud-Native/cnny-2023/tags/azure-kubernetes-service"}],readingTime:5.835,hasTruncateMarker:!1,authors:[{name:"Josh Duffney",title:"Cloud-Native Advocate @Microsoft",url:"https://github.com/duffney",imageURL:"https://github.com/duffney.png",key:"josh"}],frontMatter:{slug:"fundamentals-day-3",title:"2-3. Kubernetes Fundamentals - ConfigMaps and Secrets",authors:["josh"],draft:!1,hide_table_of_contents:!1,toc_min_heading_level:2,toc_max_heading_level:3,keywords:["kubernetes","container-apps","secrets","configuration"],image:"https://azure.github.io/Cloud-Native/img/og/30-08.png",description:"Working with ConfigMaps and Secrets in Kubernetes",tags:["cloud-native","30daysofcloudnative","zero-to-hero","ask-the-expert","azure-kubernetes-service"]},unlisted:!1,prevItem:{title:"2-2. Kubernetes Fundamentals - Services and Ingress",permalink:"/Cloud-Native/cnny-2023/fundamentals-day-2"},nextItem:{title:"2-4. Kubernetes Fundamentals - Volumes, Mounts, and Claims",permalink:"/Cloud-Native/cnny-2023/fundamentals-day-4"}},l={authorsImageUrls:[void 0]},d=[{value:"What We&#39;ll Cover",id:"what-well-cover",level:2},{value:"Decouple configurations with ConfigMaps and Secerts",id:"decouple-configurations-with-configmaps-and-secerts",level:2},{value:"Passing Environment Data with ConfigMaps and Secrets",id:"passing-environment-data-with-configmaps-and-secrets",level:2},{value:"Create the ConfigMap",id:"create-the-configmap",level:3},{value:"Create the Secret",id:"create-the-secret",level:3},{value:"Modify the app deployment manifest",id:"modify-the-app-deployment-manifest",level:3},{value:"Modify the database deployment manifest",id:"modify-the-database-deployment-manifest",level:3},{value:"Verify the ConfigMap and output environment variables",id:"verify-the-configmap-and-output-environment-variables",level:3},{value:"Verify the Secret and describe the deployment",id:"verify-the-secret-and-describe-the-deployment",level:3},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components},{Head:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t,{children:[(0,a.jsx)("meta",{name:"twitter:url",content:"https://azure.github.io/Cloud-Native/cnny-2023/fundamentals-day-3"}),(0,a.jsx)("meta",{name:"twitter:title",content:"2-3. Kubernetes Fundamentals - ConfigMaps and Secrets"}),(0,a.jsx)("meta",{name:"twitter:description",content:"Working with ConfigMaps and Secrets in Kubernetes"}),(0,a.jsx)("meta",{name:"twitter:image",content:"https://azure.github.io/Cloud-Native/img/og/30-08.png"}),(0,a.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,a.jsx)("meta",{name:"twitter:creator",content:"@joshduffney"}),(0,a.jsx)("meta",{name:"twitter:site",content:"@AzureAdvocates"}),(0,a.jsx)("link",{rel:"canonical",href:"https://azure.github.io/Cloud-Native/cnny-2023/fundamentals-day-3"})]}),"\n",(0,a.jsxs)(n.p,{children:["Welcome to ",(0,a.jsx)(n.code,{children:"Day 3 of Week 2"})," of #CloudNativeNewYear!"]}),"\n",(0,a.jsx)(n.p,{children:"The theme for this week is Kubernetes fundamentals. Yesterday we talked about Services and Ingress. Today we'll explore the topic of passing configuration and secrets to our applications in Kubernetes with ConfigMaps and Secrets."}),"\n",(0,a.jsx)(n.admonition,{title:"Ask the Experts Thursday, February 9th at 9 AM PST",type:"tip",children:(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://aka.ms/cnny/watch-ate",children:"Watch our Q&A with Experts from the Azure Kubernetes Service product team!"})})}),"\n",(0,a.jsxs)(n.admonition,{title:"Catch the Replay of the Live Demo",type:"tip",children:[(0,a.jsx)(n.p,{children:"Watch the recorded demo and conversation about this week's topics."}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://aka.ms/cnny/week2-demo",children:"We were live on YouTube walking through today's (and the rest of this week's) demos"}),"."]})]}),"\n",(0,a.jsx)(n.h2,{id:"what-well-cover",children:"What We'll Cover"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Decouple configurations with ConfigMaps and Secerts"}),"\n",(0,a.jsx)(n.li,{children:"Passing Environment Data with ConfigMaps and Secrets"}),"\n",(0,a.jsx)(n.li,{children:"Conclusion"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"decouple-configurations-with-configmaps-and-secerts",children:"Decouple configurations with ConfigMaps and Secerts"}),"\n",(0,a.jsx)(n.p,{children:"A ConfigMap is a Kubernetes object that decouples configuration data from pod definitions. Kubernetes secerts are similar, but were designed to decouple senstive information."}),"\n",(0,a.jsx)(n.p,{children:"Separating the configuration and secerts from your application promotes better organization and security of your Kubernetes environment. It also enables you to share the same configuration and different secerts across multiple pods and deployments which can simplify scaling and management. Using ConfigMaps and Secerts in Kubernetes is a best practice that can help to improve the scalability, security, and maintainability of your cluster."}),"\n",(0,a.jsx)(n.p,{children:"By the end of this tutorial, you'll have added a Kubernetes ConfigMap and Secret to the Azure Voting deployment."}),"\n",(0,a.jsx)(n.h2,{id:"passing-environment-data-with-configmaps-and-secrets",children:"Passing Environment Data with ConfigMaps and Secrets"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["\ud83d\udcdd NOTE: If you don't have an AKS cluster deployed, please head over to ",(0,a.jsx)(n.a,{href:"https://github.com/Azure-Samples/azure-voting-app-rust/tree/week2/day2",children:"Azure-Samples/azure-voting-app-rust"}),", clone the repo, and follow the instructions in the ",(0,a.jsx)(n.a,{href:"https://github.com/Azure-Samples/azure-voting-app-rust/blob/main/README.md",children:"README.md"})," to execute the Azure deployment and setup your ",(0,a.jsx)(n.code,{children:"kubectl"})," context. Check out ",(0,a.jsx)(n.a,{href:"/Cloud-Native/cnny-2023/fundamentals-day-1#setting-up-a-kubernetes-environment-in-azure",children:"the first post this week for more on the environment setup"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"create-the-configmap",children:"Create the ConfigMap"}),"\n",(0,a.jsx)(n.p,{children:"ConfigMaps can be used in one of two ways; as environment variables or volumes."}),"\n",(0,a.jsx)(n.p,{children:"For this tutorial you'll use a ConfigMap to create three environment variables inside the pod; DATABASE_SERVER, FISRT_VALUE, and SECOND_VALUE. The DATABASE_SERVER provides part of connection string to a Postgres. FIRST_VALUE and SECOND_VALUE are configuration options that change what voting options the application presents to the users."}),"\n",(0,a.jsx)(n.p,{children:"Follow the below steps to create a new ConfigMap:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create a YAML file named 'config-map.yaml'. In this file, specify the environment variables for the application."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: azure-voting-config\ndata:\n  DATABASE_SERVER: azure-voting-db\n  FIRST_VALUE: "Go"\n  SECOND_VALUE: "Rust"\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create the config map in your Kubernetes cluster by running the following command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl create -f config-map.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"create-the-secret",children:"Create the Secret"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"deployment-db.yaml"})," and ",(0,a.jsx)(n.code,{children:"deployment-app.yaml"})," are Kubernetes manifests that deploy the Azure Voting App. Currently, those deployment manifests contain the environment variables ",(0,a.jsx)(n.code,{children:"POSTGRES_PASSWORD"})," and ",(0,a.jsx)(n.code,{children:"DATABASE_PASSWORD"})," with the value stored as plain text. Your task is to replace that environment variable with a Kubernetes Secret."]}),"\n",(0,a.jsx)(n.p,{children:"Create a Secret running the following commands:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Encode ",(0,a.jsx)(n.code,{children:"mypassword"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'echo -n "mypassword" | base64\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Create a YAML file named ",(0,a.jsx)(n.code,{children:"secret.yaml"}),". In this file, add ",(0,a.jsx)(n.code,{children:"POSTGRES_PASSWORD"})," as the key and the encoded value returned above under as the value in the data section."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: azure-voting-secret\ntype: Opaque\ndata:\n  POSTGRES_PASSWORD: bXlwYXNzd29yZA==\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create the Secret in your Kubernetes cluster by running the following command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl create -f secret.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"[!WARNING]\nbase64 encoding is a simple and widely supported way to obscure plaintext data, it is not secure, as it can easily be decoded. If you want to store sensitive data like password, you should use a more secure method like encrypting with a Key Management Service (KMS) before storing it in the Secret."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"modify-the-app-deployment-manifest",children:"Modify the app deployment manifest"}),"\n",(0,a.jsx)(n.p,{children:"With the ConfigMap and Secert both created the next step is to replace the environment variables provided in the application deployment manuscript with the values stored in the ConfigMap and the Secert."}),"\n",(0,a.jsx)(n.p,{children:"Complete the following steps to add the ConfigMap and Secert to the deployment mainifest:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Open the Kubernetes manifest file ",(0,a.jsx)(n.code,{children:"deployment-app.yaml"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["In the containers section, add an ",(0,a.jsx)(n.code,{children:"envFrom"})," section and upate the ",(0,a.jsx)(n.code,{children:"env"})," section."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"envFrom:\n- configMapRef:\n    name: azure-voting-config\nenv:\n- name: DATABASE_PASSWORD\n  valueFrom:\n    secretKeyRef:\n      name: azure-voting-secret\n      key: POSTGRES_PASSWORD\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Using ",(0,a.jsx)(n.code,{children:"envFrom"})," exposes all the values witin the ConfigMap as environment variables. Making it so you don't have to list them individually."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Save the changes to the deployment manifest file."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Apply the changes to the deployment by running the following command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f deployment-app.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"modify-the-database-deployment-manifest",children:"Modify the database deployment manifest"}),"\n",(0,a.jsx)(n.p,{children:"Next, update the database deployment manifest and replace the plain text environment variable with the Kubernetes Secert."}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Open the ",(0,a.jsx)(n.code,{children:"deployment-db.yaml"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["To add the secret to the deployment, replace the ",(0,a.jsx)(n.em,{children:"env"})," section with the following code:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:"env:\n- name: POSTGRES_PASSWORD\n  valueFrom:\n    secretKeyRef:\n      name: azure-voting-secret\n      key: POSTGRES_PASSWORD\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Apply the updated manifest."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f deployment-db.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"verify-the-configmap-and-output-environment-variables",children:"Verify the ConfigMap and output environment variables"}),"\n",(0,a.jsx)(n.p,{children:"Verify that the ConfigMap was added to your deploy by running the following command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl describe deployment azure-voting-app\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Browse the output until you find the ",(0,a.jsx)(n.code,{children:"envFrom"})," section with the config map reference."]}),"\n",(0,a.jsxs)(n.p,{children:["You can also verify that the environment variables from the config map are being passed to the container by running the command ",(0,a.jsx)(n.code,{children:"kubectl exec -it <pod-name> -- printenv"}),". This command will show you all the environment variables passed to the pod including the one from configmap."]}),"\n",(0,a.jsx)(n.p,{children:"By following these steps, you will have successfully added a config map to the Azure Voting App Kubernetes deployment, and the environment variables defined in the config map will be passed to the container running in the pod."}),"\n",(0,a.jsx)(n.h3,{id:"verify-the-secret-and-describe-the-deployment",children:"Verify the Secret and describe the deployment"}),"\n",(0,a.jsx)(n.p,{children:"Once the secret has been created you can verify it exists by running the following command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get secrets\n"})}),"\n",(0,a.jsx)(n.p,{children:"You can view additional information, such as labels, annotations, type, and the Data by running kubectl describe:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl describe secret azure-voting-secret\n"})}),"\n",(0,a.jsx)(n.p,{children:"By default, the describe command doesn't output the encoded value, but if you output the results as JSON or YAML you'll be able to see the secret's encoded value."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:" kubectl get secret azure-voting-secret -o json\n"})}),"\n",(0,a.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsx)(n.p,{children:"In conclusion, using ConfigMaps and Secrets in Kubernetes can help to improve the scalability, security, and maintainability of your cluster. By decoupling configuration data and sensitive information from pod definitions, you can promote better organization and security in your Kubernetes environment. Additionally, separating these elements allows for sharing the same configuration and different secrets across multiple pods and deployments, simplifying scaling and management."}),"\n",(0,a.jsxs)(n.admonition,{title:"Take the Cloud Skills Challenge!",type:"tip",children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/training/challenges?id=a0e385b9-f970-4182-b2e2-3b4619b6c356",children:"Enroll"})," in the Cloud Skills Challenge!"]}),(0,a.jsx)(n.p,{children:"Don't miss out on this opportunity to level up your skills and stay ahead of the curve in the world of cloud native."})]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>o});var a=t(67294);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[86592],{96764:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var i=o(85893),t=o(11151);const a={slug:"windows-containers",title:"4-3. Windows Containers",authors:["vinicius"],draft:!1,hide_table_of_contents:!1,toc_min_heading_level:2,toc_max_heading_level:3,keywords:["containers","windows","aks","kubernetes"],image:"https://azure.github.io/Cloud-Native/img/og/30-18.png",description:"Let's learn about Windows containers!",tags:["cloud-native","30daysofcloudnative","zero-to-hero","ask-the-expert","azure-kubernetes-service","containers","windows"]},s=void 0,r={permalink:"/Cloud-Native/cnny-2023/windows-containers",source:"@site/blog-cnny/2023-02-15/index.md",title:"4-3. Windows Containers",description:"Let's learn about Windows containers!",date:"2023-02-15T00:00:00.000Z",formattedDate:"February 15, 2023",tags:[{label:"cloud-native",permalink:"/Cloud-Native/cnny-2023/tags/cloud-native"},{label:"30daysofcloudnative",permalink:"/Cloud-Native/cnny-2023/tags/30-daysofcloudnative"},{label:"zero-to-hero",permalink:"/Cloud-Native/cnny-2023/tags/zero-to-hero"},{label:"ask-the-expert",permalink:"/Cloud-Native/cnny-2023/tags/ask-the-expert"},{label:"azure-kubernetes-service",permalink:"/Cloud-Native/cnny-2023/tags/azure-kubernetes-service"},{label:"containers",permalink:"/Cloud-Native/cnny-2023/tags/containers"},{label:"windows",permalink:"/Cloud-Native/cnny-2023/tags/windows"}],readingTime:6.265,hasTruncateMarker:!1,authors:[{name:"Vinicius Apolinario",title:"Senior Cloud Advocate",url:"https://github.com/vrapolinario",imageURL:"https://github.com/vrapolinario.png",key:"vinicius"}],frontMatter:{slug:"windows-containers",title:"4-3. Windows Containers",authors:["vinicius"],draft:!1,hide_table_of_contents:!1,toc_min_heading_level:2,toc_max_heading_level:3,keywords:["containers","windows","aks","kubernetes"],image:"https://azure.github.io/Cloud-Native/img/og/30-18.png",description:"Let's learn about Windows containers!",tags:["cloud-native","30daysofcloudnative","zero-to-hero","ask-the-expert","azure-kubernetes-service","containers","windows"]},unlisted:!1,prevItem:{title:"4-2. Jumpstart your applications with Draft",permalink:"/Cloud-Native/cnny-2023/building-with-draft"},nextItem:{title:"4-4. Azure Kubernetes Services Add-ons and Extensions",permalink:"/Cloud-Native/cnny-2023/aks-extensions-addons"}},c={authorsImageUrls:[void 0]},l=[{value:"What We&#39;ll Cover",id:"what-well-cover",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Windows container overview",id:"windows-container-overview",level:2},{value:"Windows base container images",id:"windows-base-container-images",level:2},{value:"Isolation",id:"isolation",level:2},{value:"Exercise",id:"exercise",level:2},{value:"Run Windows containers via Docker on your machine",id:"run-windows-containers-via-docker-on-your-machine",level:3},{value:"Run Windows containers on Kubernetes",id:"run-windows-containers-on-kubernetes",level:3},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components},{Head:o}=n;return o||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o,{children:[(0,i.jsx)("meta",{name:"twitter:url",content:"https://azure.github.io/Cloud-Native/cnny-2023/windows-containers"}),(0,i.jsx)("meta",{name:"twitter:title",content:"Windows Containers"}),(0,i.jsx)("meta",{name:"twitter:description",content:"Let's learn about Windows containers!"}),(0,i.jsx)("meta",{name:"twitter:image",content:"https://azure.github.io/Cloud-Native/img/og/30-18.png"}),(0,i.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,i.jsx)("meta",{name:"twitter:creator",content:"@vrapolinario"}),(0,i.jsx)("meta",{name:"twitter:site",content:"@AzureAdvocates"}),(0,i.jsx)("link",{rel:"canonical",href:"https://azure.github.io/Cloud-Native/cnny-2023/windows-containers"})]}),"\n",(0,i.jsxs)(n.p,{children:["Welcome to ",(0,i.jsx)(n.code,{children:"Day 3 of Week 4"})," of #CloudNativeNewYear!"]}),"\n",(0,i.jsx)(n.p,{children:"The theme for this week is going further with Cloud Native. Yesterday we talked about using Draft to accelerate your Kubernetes adoption. Today we'll explore the topic of Windows containers."}),"\n",(0,i.jsx)(n.h2,{id:"what-well-cover",children:"What We'll Cover"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Introduction"}),"\n",(0,i.jsx)(n.li,{children:"Windows containers overview"}),"\n",(0,i.jsx)(n.li,{children:"Windows base container images"}),"\n",(0,i.jsx)(n.li,{children:"Isolation"}),"\n",(0,i.jsx)(n.li,{children:"Exercise: Try this yourself!"}),"\n",(0,i.jsx)(n.li,{children:"Resources: For self-study!"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"Windows containers were launched along with Windows Server 2016, and have evolved since. In its latest release, Windows Server 2022, Windows containers have reached a great level of maturity and allow for customers to run production grade workloads."}),"\n",(0,i.jsx)(n.p,{children:"While suitable for new developments, Windows containers also provide developers and operations with a different approach than Linux containers. It allows for existing Windows applications to be containerized with little or no code changes. It also allows for professionals that are more comfortable with the Windows platform and OS, to leverage their skill set, while taking advantage of the containers platform."}),"\n",(0,i.jsx)(n.h2,{id:"windows-container-overview",children:"Windows container overview"}),"\n",(0,i.jsx)(n.p,{children:"In essence, Windows containers are very similar to Linux. Since Windows containers use the same foundation of Docker containers, you can expect that the same architecture applies - with the specific notes of the Windows OS. For example, when running a Windows container via Docker, you use the same commands, such as docker run. To pull a container image, you can use docker pull, just like on Linux. However, to run a Windows container, you also need a Windows container host. This requirement is there because, as you might remember, a container shares the OS kernel with its container host."}),"\n",(0,i.jsx)(n.p,{children:"On Kubernetes, Windows containers are supported since Windows Server 2019. Just like with Docker, you can manage Windows containers like any other resource on the Kubernetes ecosystem. A Windows node can be part of a Kubernetes cluster, allowing you to run Windows container based applications on services like Azure Kubernetes Service. To deploy an Windows application to a Windows pod in Kubernetes, you can author a YAML specification much like you would for Linux. The main difference is that you would point to an image that runs on Windows, and you need to specify a node selection tag to indicate said pod needs to run on a Windows node."}),"\n",(0,i.jsx)(n.h2,{id:"windows-base-container-images",children:"Windows base container images"}),"\n",(0,i.jsx)(n.p,{children:"On Windows containers, you will always use a base container image provided by Microsoft. This base container image contains the OS binaries for the container to run. This image can be as large as 3GB+, or small as ~300MB. The difference in the size is a consequence of the APIs and components available in each Windows container base container image. There are primarily, three images: Nano Server, Server Core, and Server."}),"\n",(0,i.jsx)(n.p,{children:"Nano Server is the smallest image, ranging around 300MB. It's a base container image for new developments and cloud-native scenarios. Applications need to target Nano Server as the Windows OS, so not all frameworks will work. For example, .Net works on Nano Server, but .Net Framework doesn't. Other third-party frameworks also work on Nano Server, such as Apache, NodeJS, Phyton, Tomcat, Java runtime, JBoss, Redis, among others."}),"\n",(0,i.jsx)(n.p,{children:"Server Core is a much larger base container image, ranging around 1.25GB. It's larger size is compensated by it's application compatibility. Simply put, any application that meets the requirements to be run on a Windows container, can be containerized with this image."}),"\n",(0,i.jsx)(n.p,{children:"The Server image builds on the Server Core one. It ranges around 3.1GB and has even greater application compatibility than the Server Core image. In addition to the traditional Windows APIs and components, this image allows for scenarios such as Machine Learning via DirectX with GPU access."}),"\n",(0,i.jsx)(n.p,{children:"The best image for your scenario is dependent on the requirements your application has on the Windows OS inside a container. However, there are some scenarios that are not supported at all on Windows containers - such as GUI or RDP dependent applications, some Windows Server infrastructure roles, such as Active Directory, among others."}),"\n",(0,i.jsx)(n.h2,{id:"isolation",children:"Isolation"}),"\n",(0,i.jsx)(n.p,{children:"When running containers, the kernel of the container host is shared with the containers running on it. While extremely convenient, this poses a potential risk for multi-tenant scenarios. If one container is compromised and has access to the host, it could potentially compromise other containers in the same system."}),"\n",(0,i.jsxs)(n.p,{children:["For enterprise customers running on-premises (or even in the cloud), this can be mitigated by using a VM as a container host and considering the VM itself a security boundary. However, if multiple workloads from different tenants need to share the same host, Windows containers offer another option: Hyper-V isolation. While the name Hyper-V is associated with VMs, its virtualization capabilities extend to other services, including containers. Hyper-V isolated containers run on a purpose built, extremely small, highly performant VM. However, you manage a container running with Hyper-V isolation the same way you do with a process isolated one. In fact, the only notable difference is that you need to append the ",(0,i.jsx)(n.code,{children:"--isolation=hyperv"})," tag to the ",(0,i.jsx)(n.code,{children:"docker run"})," command."]}),"\n",(0,i.jsx)(n.h2,{id:"exercise",children:"Exercise"}),"\n",(0,i.jsx)(n.p,{children:"Here are a few examples of how to use Windows containers:"}),"\n",(0,i.jsx)(n.h3,{id:"run-windows-containers-via-docker-on-your-machine",children:"Run Windows containers via Docker on your machine"}),"\n",(0,i.jsx)(n.p,{children:"To pull a Windows base container image:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"docker pull mcr.microsoft.com/windows/servercore:ltsc2022\n"})}),"\n",(0,i.jsx)(n.p,{children:"To run a basic IIS container:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"#This command will pull and start a IIS container. You can access it from http://<your local IP>:8080\ndocker run -d -p 8080:80 mcr.microsoft.com/windows/servercore/iis:windowsservercore-ltsc2022\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run the same IIS container with Hyper-V isolation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"#This command will pull and start a IIS container. You can access it from http://<your local IP>:8080\ndocker run -d -p 8080:80 --isolation=hyperv mcr.microsoft.com/windows/servercore/iis:windowsservercore-ltsc2022\n"})}),"\n",(0,i.jsx)(n.p,{children:"To run a Windows container interactively:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"docker run -it mcr.microsoft.com/windows/servercore:ltsc2022 powershell\n"})}),"\n",(0,i.jsx)(n.h3,{id:"run-windows-containers-on-kubernetes",children:"Run Windows containers on Kubernetes"}),"\n",(0,i.jsx)(n.p,{children:"To prepare an AKS cluster for Windows containers:\nNote: Replace the values on the example below with the ones from your environment."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-azurecli",children:'echo "Please enter the username to use as administrator credentials for Windows Server nodes on your cluster: " && read WINDOWS_USERNAME\naz aks create \\\n    --resource-group myResourceGroup \\\n    --name myAKSCluster \\\n    --node-count 2 \\\n    --generate-ssh-keys \\\n    --windows-admin-username $WINDOWS_USERNAME \\\n    --vm-set-type VirtualMachineScaleSets \\\n    --network-plugin azure\n'})}),"\n",(0,i.jsx)(n.p,{children:"To add a Windows node pool for Windows containers:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-azurecli",children:"az aks nodepool add \\\n    --resource-group myResourceGroup \\\n    --cluster-name myAKSCluster \\\n    --os-type Windows \\\n    --name npwin \\\n    --node-count 1\n"})}),"\n",(0,i.jsx)(n.p,{children:"Deploy a sample ASP.Net application to the AKS cluster above using the YAML file below:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: sample\n  labels:\n    app: sample\nspec:\n  replicas: 1\n  template:\n    metadata:\n      name: sample\n      labels:\n        app: sample\n    spec:\n      nodeSelector:\n        "kubernetes.io/os": windows\n      containers:\n      - name: sample\n        image: mcr.microsoft.com/dotnet/framework/samples:aspnetapp\n        resources:\n          limits:\n            cpu: 1\n            memory: 800M\n        ports:\n          - containerPort: 80\n  selector:\n    matchLabels:\n      app: sample\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: sample\nspec:\n  type: LoadBalancer\n  ports:\n  - protocol: TCP\n    port: 80\n  selector:\n    app: sample\n'})}),"\n",(0,i.jsx)(n.p,{children:"Save the file above and run the command below on your Kubernetes cluster:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"kubectl apply -f <filename> .\n"})}),"\n",(0,i.jsx)(n.p,{children:"Once deployed, you can access the application by getting the IP address of your service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"kubectl get service\n"})}),"\n",(0,i.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.mdxAdmonitionTitle,{children:["It's not too late to sign up for and complete the ",(0,i.jsx)(n.a,{href:"https://aka.ms/CNNY/Challenge",children:"Cloud Skills Challenge"}),"!"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/virtualization/windowscontainers/?WT.mc_id=containers-84290-viniap",children:"Windows containers documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/azure/aks/learn/quick-windows-container-deploy-cli?WT.mc_id=containers-84290-viniap",children:"Run Windows containers on AKS"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},11151:(e,n,o)=>{o.d(n,{Z:()=>r,a:()=>s});var i=o(67294);const t={},a=i.createContext(t);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);
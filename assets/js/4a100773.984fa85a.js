"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[40339],{3605:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var s=o(85893),n=o(11151);const r={slug:"17-integrate-cosmosdb",title:"17. Logic Apps + Cosmos DB",authors:["brian"],draft:!1,hide_table_of_contents:!1,toc_min_heading_level:2,toc_max_heading_level:3,keywords:["azure","functions","serverless","concepts","logicapps"],image:"./img/banner.png",description:"<FIXME>",tags:["serverless-september","30-days-of-serverless","azure-container-apps","dapr","microservices"]},i=void 0,a={permalink:"/Cloud-Native/blog/17-integrate-cosmosdb",source:"@site/blog/2022-09-17/index.md",title:"17. Logic Apps + Cosmos DB",description:"<FIXME>",date:"2022-09-17T00:00:00.000Z",formattedDate:"September 17, 2022",tags:[{label:"serverless-september",permalink:"/Cloud-Native/blog/tags/serverless-september"},{label:"30-days-of-serverless",permalink:"/Cloud-Native/blog/tags/30-days-of-serverless"},{label:"azure-container-apps",permalink:"/Cloud-Native/blog/tags/azure-container-apps"},{label:"dapr",permalink:"/Cloud-Native/blog/tags/dapr"},{label:"microservices",permalink:"/Cloud-Native/blog/tags/microservices"}],readingTime:5.475,hasTruncateMarker:!1,authors:[{name:"Brian Benz",title:"Senior Cloud Advocate @Microsoft",url:"https://github.com/bbenz",imageURL:"https://github.com/bbenz.png",key:"brian"}],frontMatter:{slug:"17-integrate-cosmosdb",title:"17. Logic Apps + Cosmos DB",authors:["brian"],draft:!1,hide_table_of_contents:!1,toc_min_heading_level:2,toc_max_heading_level:3,keywords:["azure","functions","serverless","concepts","logicapps"],image:"./img/banner.png",description:"<FIXME>",tags:["serverless-september","30-days-of-serverless","azure-container-apps","dapr","microservices"]},unlisted:!1,prevItem:{title:"18. Logic Apps + Computer Vision",permalink:"/Cloud-Native/blog/18-cloudmail"},nextItem:{title:"15. ACA + Serverless On Azure",permalink:"/Cloud-Native/blog/15-microservices-azure"}},c={image:o(21621).Z,authorsImageUrls:[void 0]},l=[{value:"What We&#39;ll Cover",id:"what-well-cover",level:2},{value:"Introduction to Logic Apps",id:"introduction-to-logic-apps",level:2},{value:"Setup Cosmos DB for Logic Apps",id:"setup-cosmos-db-for-logic-apps",level:2},{value:"Setup Logic App connection + event",id:"setup-logic-app-connection--event",level:2},{value:"Write data from Logic App to Cosmos DB",id:"write-data-from-logic-app-to-cosmos-db",level:2},{value:"Resources: For self-study!",id:"resources-for-self-study",level:2}];function d(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.a)(),...e.components},{Head:r}=t;return r||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r,{children:[(0,s.jsx)("meta",{name:"twitter:url",content:"https://azure.github.io/Cloud-Native/blog/17-integrate-cosmosdb"}),(0,s.jsx)("meta",{name:"twitter:title",content:"#30DaysOfServerless: Azure Functions Fundamentals"}),(0,s.jsx)("meta",{name:"twitter:description",content:"#30DaysOfServerless: Azure Functions Fundamentals"}),(0,s.jsx)("meta",{name:"twitter:image",content:"https://azure.github.io/Cloud-Native/img/banners/post-kickoff.png"}),(0,s.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,s.jsx)("meta",{name:"twitter:creator",content:"@nitya"}),(0,s.jsx)("meta",{name:"twitter:site",content:"@AzureAdvocates"}),(0,s.jsx)("link",{rel:"canonical",href:"https://azure.github.io/Cloud-Native/blog/17-integrate-cosmosdb"})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:["Welcome to ",(0,s.jsx)(t.code,{children:"Day 17"})," of #30DaysOfServerless!"]}),"\n",(0,s.jsxs)(t.p,{children:["In past weeks, we've covered serverless technologies that provide core capabilities (functions, containers, microservices) for building serverless solutions. This week we're looking at technologies that make ",(0,s.jsx)(t.strong,{children:"service integrations"})," more seamless, starting with ",(0,s.jsx)(t.strong,{children:"Logic Apps"}),". Let's look at one usage example today!"]}),"\n",(0,s.jsx)(t.p,{children:"Ready? Let's Go!"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"what-well-cover",children:"What We'll Cover"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Introduction to Logic Apps"}),"\n",(0,s.jsx)(t.li,{children:"Settng up Cosmos DB for Logic Apps"}),"\n",(0,s.jsx)(t.li,{children:"Setting up a Logic App connection and event"}),"\n",(0,s.jsx)(t.li,{children:"Writing data to Cosmos DB from a Logic app"}),"\n",(0,s.jsx)(t.li,{children:"Resources: For self-study!"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Serverless September session on using CosmosDB and Logic Apps for tracking weather data changes, hosted by Brian Benz.",src:o(17380).Z+"",width:"1600",height:"672"})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"introduction-to-logic-apps",children:"Introduction to Logic Apps"}),"\n",(0,s.jsx)(t.p,{children:"Previously in Serverless September, we've covered Azure Functions, where the event triggers code. In Logic Apps, the event triggers a workflow that you design. Logic Apps enable serverless applications to connect to external sources for data then automate business processes via workflows."}),"\n",(0,s.jsx)(t.p,{children:"In this post I'll walk you through setting up a Logic App that works with Cosmos DB.  For this example, we'll connect to the MSN weather service, an design a logic app workflow that collects data when weather changes, and writes the data to Cosmos DB."}),"\n",(0,s.jsx)(t.admonition,{title:"PREREQUISITES",type:"info",children:(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"An active Azure subscription (with Contributor or Owner permissions)."}),"\n",(0,s.jsxs)(t.li,{children:["Don't have one? ",(0,s.jsx)(t.a,{href:"https://azure.microsoft.com/free/",children:"Create an account for free"}),"."]}),"\n"]})}),"\n",(0,s.jsx)(t.h2,{id:"setup-cosmos-db-for-logic-apps",children:"Setup Cosmos DB for Logic Apps"}),"\n",(0,s.jsxs)(t.p,{children:["Cosmos DB has ",(0,s.jsx)(t.a,{href:"https://learn.microsoft.com/azure/cosmos-db/choose-api",children:"many APIs to choose from"}),", but to use the ",(0,s.jsx)(t.a,{href:"https://docs.microsoft.com/connectors/documentdb/",children:"default Logic App connection"}),", we need to choose the a Cosmos DB SQL API.  We'll set this up via the Azure Portal."]}),"\n",(0,s.jsxs)(t.p,{children:["To get started with Cosmos DB, you create an account, then a database, then a container to store JSON documents. To create a new Cosmos DB account from the ",(0,s.jsx)(t.a,{href:"https://portal.azure.com",children:"portal dashboard"}),", Select ",(0,s.jsx)(t.strong,{children:"Create a resource > Azure Cosmos DB > Create"}),".  Choose ",(0,s.jsx)(t.strong,{children:"core SQL"})," for the API."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Azure Cosmos DB API selection screen showing Core SQL, MongoDB, Cassandra, Azure Table, and Gremlin options with &quot;Create&quot; buttons.",src:o(54858).Z+"",width:"2976",height:"1478"})}),"\n",(0,s.jsxs)(t.p,{children:["Select your subscription, then create a new resource group called ",(0,s.jsx)(t.strong,{children:"CosmosWeather"}),".  Enter an account name and choose a location, select provisioned throughput capacity mode and apply the free tier discount. From here you can select ",(0,s.jsx)(t.strong,{children:"Review and Create"}),", then ",(0,s.jsx)(t.strong,{children:"Create"})]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["Azure Cosmos DB is available in two different capacity modes: provisioned throughput and ",(0,s.jsx)(t.a,{href:"https://docs.microsoft.com/azure/cosmos-db/throughput-serverless",children:"serverless"}),". You can perform the same database operations in both modes, but the way you get billed for these operations is different. We wil be using provisioned throughput and the free tier for this example."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Setup the CosmosDB account",src:o(52498).Z+"",width:"2455",height:"1705"})}),"\n",(0,s.jsxs)(t.p,{children:["Next, create a new database and container. Go to the ",(0,s.jsx)(t.strong,{children:"Data Explorer"})," in your new Cosmos DB account, and choose ",(0,s.jsx)(t.strong,{children:"New Container"}),".  Name the database, and keep all the orher defaults except:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Setting"}),(0,s.jsx)(t.th,{children:"Action"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Container ID"}),(0,s.jsx)(t.td,{children:"id"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Container partition"}),(0,s.jsx)(t.td,{children:"/id"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["Press ",(0,s.jsx)(t.strong,{children:"OK"})," to create a database and container"]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"A database is analogous to a traditional DBMS namespace. It's used to organize one or more containers."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Setup the CosmosDB Container",src:o(50642).Z+"",width:"2424",height:"1767"})}),"\n",(0,s.jsx)(t.p,{children:"Now we're ready to set up our logic app an write to Cosmos DB!"}),"\n",(0,s.jsx)(t.h2,{id:"setup-logic-app-connection--event",children:"Setup Logic App connection + event"}),"\n",(0,s.jsxs)(t.p,{children:["Once the Cosmos DB SQL API account is created, we can set up our Logic App.  From the ",(0,s.jsx)(t.a,{href:"https://portal.azure.com",children:"portal dashboard"}),", Select ",(0,s.jsx)(t.strong,{children:"Create a resource > Integration > Logic App > Create"}),".  Name your Logic App and select a location, the rest fo the settings can be left at their defaults.  Once you new Logic App is created, select ",(0,s.jsx)(t.strong,{children:"Create a workflow from designer"})," to get started."]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"A workflow is a series of steps that defines a task or process. Each workflow starts with a single trigger, after which you must add one or more actions."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["When in designer, search for ",(0,s.jsx)(t.strong,{children:"weather"})," on the right under ",(0,s.jsx)(t.strong,{children:"Add a trigger"}),".  Choose ",(0,s.jsx)(t.strong,{children:"MSN Weather"}),".  Choose\n",(0,s.jsx)(t.strong,{children:"When the current conditions change"})," as the trigger."]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"A trigger is always the first step in any workflow and specifies the condition for running any further steps in that workflow."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Add a location.  Valid locations are City, Region, State, Country, Landmark, Postal Code, latitude and longitude.  This triggers a new workflow when the conditions change for a location."}),"\n",(0,s.jsx)(t.h2,{id:"write-data-from-logic-app-to-cosmos-db",children:"Write data from Logic App to Cosmos DB"}),"\n",(0,s.jsxs)(t.p,{children:["Now we are ready to set up the action to write data to Cosmos DB.  Choose ",(0,s.jsx)(t.strong,{children:"add an action"})," and choose Cosmos DB."]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"An action is each step in a workflow after the trigger. Every action runs some operation in a workflow."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["In this case, we will be writing a JSON document to the Cosmos DB container we created earlier.  Choose ",(0,s.jsx)(t.strong,{children:"Create or Update Document"})," from the actions.  At this point you should have a workflow in designer that looks something like this:"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Logic App workflow with trigger",src:o(94915).Z+"",width:"1145",height:"856"})}),"\n",(0,s.jsxs)(t.p,{children:["Start wth the connection for set up the Cosmos DB action.  Select ",(0,s.jsx)(t.strong,{children:"Access Key"}),", and provide the primary read-write key (found under keys in Cosmos DB), and the Cosmos DB account ID (without 'documents.azure.com')."]}),"\n",(0,s.jsx)(t.p,{children:"Next, fill in your Cosmos DB Database ID and Collection ID.  Create a JSON document bt selecting dynamic content elements and wrapping JSON formatting around them."}),"\n",(0,s.jsxs)(t.p,{children:["You will need a unique ID for each document that you write to Cosmos DB, for that you can use an expression.  Because we declared ",(0,s.jsx)(t.strong,{children:"id"})," to be our unique ID in Cosmos DB, we will use use that for the name.  Under expressions, type ",(0,s.jsx)(t.code,{children:"guid()"})," and press enter to add a unique ID to the JSON document.  When complete, you should have a workflow in designer that looks something like this:"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Logic App workflow with trigger and action",src:o(78950).Z+"",width:"1906",height:"1530"})}),"\n",(0,s.jsxs)(t.p,{children:["Save the workflow and test the connections by clicking ",(0,s.jsx)(t.strong,{children:"Run Trigger > Run"}),".  If connections are working, you should see documents flowing into Cosmos DB over the next few minutes."]}),"\n",(0,s.jsxs)(t.p,{children:["Check the data in Cosmos Db by opening the Data explorer, then choosing the container you created and selecting ",(0,s.jsx)(t.strong,{children:"items"}),".  You should see documents similar to this:"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Logic App workflow with trigger and action",src:o(11160).Z+"",width:"2712",height:"1761"})}),"\n",(0,s.jsx)(t.h2,{id:"resources-for-self-study",children:"Resources: For self-study!"}),"\n",(0,s.jsx)(t.p,{children:"Once you've grasped the basics in ths post, there is so much more to learn!"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Check out the other ",(0,s.jsx)(t.a,{href:"https://azure.github.io/Cloud-Native/blog",children:"Serverless September posts"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["For more detail about Cosmos DB, see the docs at ",(0,s.jsx)(t.a,{href:"https://learn.microsoft.com/azure/cosmos-db/",children:"https://learn.microsoft.com/azure/cosmos-db/"})]}),"\n",(0,s.jsxs)(t.li,{children:["For more info on Logic Apps, see the docs at ",(0,s.jsx)(t.a,{href:"https://learn.microsoft.com/azure/logic-apps/",children:"https://learn.microsoft.com/azure/logic-apps/"})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Thanks for stopping by!"})]})}function h(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},21621:(e,t,o)=>{o.d(t,{Z:()=>s});const s=o.p+"assets/images/banner-285b55411e45272a99069fd37ec84557.png"},17380:(e,t,o)=>{o.d(t,{Z:()=>s});const s=o.p+"assets/images/banner-285b55411e45272a99069fd37ec84557.png"},52498:(e,t,o)=>{o.d(t,{Z:()=>s});const s=o.p+"assets/images/cosmosdbaccount-6ea06e0494167d6441438aca97437d71.png"},54858:(e,t,o)=>{o.d(t,{Z:()=>s});const s=o.p+"assets/images/cosmosdbapiselection-573c0193332958da1c5090a29c6a7941.png"},50642:(e,t,o)=>{o.d(t,{Z:()=>s});const s=o.p+"assets/images/cosmosdbcontainer-c65af0651e4633b0a779c276b6eb3ae8.png"},11160:(e,t,o)=>{o.d(t,{Z:()=>s});const s=o.p+"assets/images/cosmosdresults-cd7ecf449f4cf9aa49ec2d3343a774ac.png"},94915:(e,t,o)=>{o.d(t,{Z:()=>s});const s=o.p+"assets/images/logicappworkflow1-f6bd9943b7239df52a2f6143b5cc5d46.png"},78950:(e,t,o)=>{o.d(t,{Z:()=>s});const s=o.p+"assets/images/logicappworkflow2-f2d7cbaa73c21f5f7552db112dd7bb33.png"},11151:(e,t,o)=>{o.d(t,{Z:()=>a,a:()=>i});var s=o(67294);const n={},r=s.createContext(n);function i(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);